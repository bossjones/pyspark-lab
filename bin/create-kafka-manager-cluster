#!/usr/bin/env bash

set -x

CreateKafkaManagerCluster() {
    # curl -XPOST -D- ${HOST_IP}:9000/clusters \
    #   --data-urlencode \
    #   "name=${_YOUR_HOSTNAME}&zkHosts=${HOST_IP}:32181/&kafkaVersion=0.9.0.1&jmxUser=&jmxPass=&tuning.brokerViewUpdatePeriodSeconds=30&tuning.clusterManagerThreadPoolSize=2&tuning.clusterManagerThreadPoolQueueSize=100&tuning.kafkaCommandThreadPoolSize=2&tuning.kafkaCommandThreadPoolQueueSize=100&tuning.logkafkaCommandThreadPoolSize=2&tuning.logkafkaCommandThreadPoolQueueSize=100&tuning.logkafkaUpdatePeriodSeconds=30&tuning.partitionOffsetCacheTimeoutSecs=5&tuning.brokerViewThreadPoolSize=2&tuning.brokerViewThreadPoolQueueSize=1000&tuning.offsetCacheThreadPoolSize=2&tuning.offsetCacheThreadPoolQueueSize=1000&tuning.kafkaAdminClientThreadPoolSize=2&tuning.kafkaAdminClientThreadPoolQueueSize=1000"

    curl -XPOST -D- ${HOST_IP}:9000/clusters --data "name=${_YOUR_HOSTNAME}&zkHosts=${HOST_IP}:32181&kafkaVersion=0.9.0.1"
}


until CreateKafkaManagerCluster; do
  echo 'Creating Kafka Manager Cluster...'
  sleep 1
done
echo 'Done!'

wait
